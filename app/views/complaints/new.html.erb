<% content_for(:title, "File Complaint - JusticeHub") %>

<div class="complaint-page">
  <div class="complaint-page-header">
    <h1>File Your Complaint</h1>
    <p>Get the justice you deserve. Start your complaint today.</p>
  </div>

  <div class="complaint-type-selector">
    <label>Select Complaint Type:</label>
    <div class="type-buttons">
      <% ComplaintFormPresenter.complaint_types.each do |type, info| %>
        <%= link_to new_complaint_path(category: type),
                    class: "type-btn #{params[:category] == type.to_s || (!params[:category] && type == :employment) ? 'active' : ''}" do %>
          <i class="fas <%= info[:icon] %>"></i>
          <span><%= info[:name] %></span>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="complaint-page-form">
    <%= form_with model: @complaint, local: true do |f| %>
      
      <!-- Base Complaint Fields -->
      <div class="form-section">
        <h3>Personal Information</h3>
        
        <div class="form-row">
          <div class="form-group">
            <%= f.label :user_name, "Full Name *", class: "form-label" %>
            <%= f.text_field :user_name, 
                              class: "form-control #{'error' if @complaint.errors[:user_name].any?}",
                              placeholder: "Enter your full name",
                              required: true %>
            <% if @complaint.errors[:user_name].any? %>
              <span class="error-message"><%= @complaint.errors[:user_name].first %></span>
            <% end %>
          </div>
          
          <div class="form-group">
            <%= f.label :complaint_type, "Complaint Type *", class: "form-label" %>
            <%= f.select :complaint_type, 
                         ComplaintFormPresenter.complaint_types.map { |k, v| [v[:name], k] },
                         { selected: @complaint_type },
                         class: "form-control",
                         required: true,
                         id: "complaint_type_select" %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :user_email, "Email Address *", class: "form-label" %>
            <%= f.email_field :user_email,
                              class: "form-control #{'error' if @complaint.errors[:user_email].any?}",
                              placeholder: "your@email.com",
                              required: true %>
            <% if @complaint.errors[:user_email].any? %>
              <span class="error-message"><%= @complaint.errors[:user_email].first %></span>
            <% end %>
          </div>
          
          <div class="form-group">
            <%= f.label :user_phone, "Phone Number *", class: "form-label" %>
            <%= f.telephone_field :user_phone,
                                  class: "form-control #{'error' if @complaint.errors[:user_phone].any?}",
                                  placeholder: "+91 XXXXX XXXXX",
                                  required: true %>
            <% if @complaint.errors[:user_phone].any? %>
              <span class="error-message"><%= @complaint.errors[:user_phone].first %></span>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Complaint Details -->
      <div class="form-section">
        <h3>Complaint Details</h3>
        
        <div class="form-group">
          <%= f.label :subject, "Subject *", class: "form-label" %>
          <%= f.text_field :subject,
                           class: "form-control #{'error' if @complaint.errors[:subject].any?}",
                           placeholder: "Brief summary of your issue",
                           required: true %>
          <% if @complaint.errors[:subject].any? %>
            <span class="error-message"><%= @complaint.errors[:subject].first %></span>
          <% end %>
        </div>

        <div class="form-group">
          <%= f.label :description, "Description *", class: "form-label" %>
          <%= f.text_area :description,
                          class: "form-control #{'error' if @complaint.errors[:description].any?}",
                          placeholder: "Describe your issue in detail. Include all relevant facts, dates, and parties involved.",
                          rows: 6,
                          required: true %>
          <% if @complaint.errors[:description].any? %>
            <span class="error-message"><%= @complaint.errors[:description].first %></span>
          <% end %>
        </div>

        <div class="form-group">
          <%= f.label :amount, "Amount Involved (â‚¹)", class: "form-label" %>
          <%= f.number_field :amount,
                             class: "form-control",
                             placeholder: "0.00",
                             min: 0,
                             step: 0.01 %>
          <small class="form-hint">Enter the amount involved in your complaint (if any)</small>
        </div>

        <div class="form-group">
          <%= f.label :documents, "Attach Documents", class: "form-label" %>
          <%= f.file_field :documents,
                           class: "form-control",
                           multiple: true,
                           accept: ".pdf,.jpg,.jpeg,.png,.doc,.docx" %>
          <small class="form-hint">Upload relevant documents, contracts, screenshots, etc. (Max 10MB each)</small>
        </div>
      </div>

      <!-- Type-Specific Fields -->
      <% if @fields && @fields.any? %>
        <div class="form-section">
          <h3><%= @type_info[:name] %> Specific Details</h3>
          
          <% case @complaint_type %>
          <% when 'employment' %>
            <%= f.fields_for :employment_complaint, @type_specific do |ef| %>
              <%= render 'employment_fields', f: ef %>
            <% end %>
            
          <% when 'student_coaching' %>
            <%= f.fields_for :student_coaching_complaint, @type_specific do |ef| %>
              <%= render 'student_coaching_fields', f: ef %>
            <% end %>
            
          <% when 'consumer' %>
            <%= f.fields_for :consumer_complaint, @type_specific do |ef| %>
              <%= render 'consumer_fields', f: ef %>
            <% end %>
            
          <% when 'property' %>
            <%= f.fields_for :property_complaint, @type_specific do |ef| %>
              <%= render 'property_fields', f: ef %>
            <% end %>
            
          <% when 'student_college' %>
            <%= f.fields_for :student_college_complaint, @type_specific do |ef| %>
              <%= render 'student_college_fields', f: ef %>
            <% end %>
            
          <% when 'financial' %>
            <%= f.fields_for :financial_complaint, @type_specific do |ef| %>
              <%= render 'financial_fields', f: ef %>
            <% end %>
            
          <% when 'matrimonial' %>
            <%= f.fields_for :matrimonial_complaint, @type_specific do |ef| %>
              <%= render 'matrimonial_fields', f: ef %>
            <% end %>
            
          <% when 'rental' %>
            <%= f.fields_for :rental_complaint, @type_specific do |ef| %>
              <%= render 'rental_fields', f: ef %>
            <% end %>
          <% end %>
        </div>
      <% end %>

      <!-- Submit Button -->
      <div class="form-actions">
        <%= f.submit "Submit Complaint", class: "btn btn-primary btn-large" do %>
          <i class="fas fa-paper-plane"></i>
        <% end %>
      </div>
      
    <% end %>
  </div>
</div>

<style>
.complaint-page {
  padding: 120px 24px 80px;
  max-width: 900px;
  margin: 0 auto;
}

.complaint-page-header {
  text-align: center;
  margin-bottom: 40px;
}

.complaint-page-header h1 {
  font-size: 36px;
  margin-bottom: 12px;
}

.complaint-page-header p {
  color: var(--text-light);
  font-size: 17px;
}

.complaint-type-selector {
  background: var(--bg-light);
  padding: 24px;
  border-radius: var(--radius-md);
  margin-bottom: 30px;
}

.complaint-type-selector label {
  display: block;
  font-weight: 500;
  margin-bottom: 16px;
  color: var(--text-dark);
}

.type-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.type-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: var(--bg-white);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 14px;
  font-weight: 500;
  color: var(--text-medium);
  transition: var(--transition);
}

.type-btn:hover {
  border-color: var(--primary-color);
  color: var(--primary-color);
}

.type-btn.active {
  background: var(--primary-color);
  border-color: var(--primary-color);
  color: var(--white);
}

.type-btn i {
  font-size: 16px;
}

.complaint-page-form {
  background: var(--bg-light);
  padding: 40px;
  border-radius: var(--radius-lg);
}

.form-section {
  margin-bottom: 40px;
  padding-bottom: 30px;
  border-bottom: 1px solid var(--border-color);
}

.form-section:last-of-type {
  border-bottom: none;
  margin-bottom: 30px;
}

.form-section h3 {
  font-size: 20px;
  margin-bottom: 24px;
  color: var(--text-dark);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-dark);
  margin-bottom: 8px;
}

.form-control {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 15px;
  color: var(--text-dark);
  background: var(--bg-white);
  transition: var(--transition);
}

.form-control:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.15);
}

.form-control.error {
  border-color: var(--secondary-color);
}

.form-control::placeholder {
  color: var(--text-muted);
}

.form-hint {
  display: block;
  margin-top: 6px;
  font-size: 12px;
  color: var(--text-light);
}

.error-message {
  display: block;
  margin-top: 6px;
  font-size: 13px;
  color: var(--secondary-color);
}

.form-actions {
  text-align: center;
  padding-top: 20px;
}

.btn-large {
  padding: 16px 48px;
  font-size: 16px;
}

@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .type-buttons {
    flex-direction: column;
  }
  
  .type-btn {
    width: 100%;
    justify-content: center;
  }
}
</style>
